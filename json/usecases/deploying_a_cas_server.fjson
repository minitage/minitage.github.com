{"body": "<div class=\"section\" id=\"install-a-project-with-a-cas-server-wired-on-an-openldap-backend\">\n<h1>Install a project with a CAS server wired on an OpenLDAP backend<a class=\"headerlink\" href=\"#install-a-project-with-a-cas-server-wired-on-an-openldap-backend\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<div class=\"section\" id=\"minitage\">\n<h2>Minitage<a class=\"headerlink\" href=\"#minitage\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Installer minitage as the official documentation says. <tt class=\"docutils literal\"><span class=\"pre\">http://www.minitage.org/installation.html</span></tt>.</p>\n<p>Take $MT as the minitage installation prefix.</p>\n<div class=\"highlight-python\"><pre>MT=$HOME/minitage/</pre>\n</div>\n<p>Be up to date before each minitage commande usage</p>\n<div class=\"highlight-python\"><pre>easy_install -U minitage.core minitage.paste minitage.paste.extras</pre>\n</div>\n<p>Right after minitage installation, issue the following commands</p>\n<div class=\"highlight-python\"><pre>cd $MT/minilays\nsvn co https://yoururl/yourminilay\ncd $MT\nminimerge myproject\npaster create -t minitage.instances.env myproject\n. $MT/zope/myproject/sys/share/minitage/minitage.env</pre>\n</div>\n<p>Now, there are 3 tasks left:</p>\n<ul class=\"simple\">\n<li>LDAP server configuration</li>\n<li>CAS (sso) server configuration</li>\n</ul>\n</div>\n<div class=\"section\" id=\"ldap-configuration\">\n<h2>Ldap configuration<a class=\"headerlink\" href=\"#ldap-configuration\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Install a non privilegied slapd instance.</p>\n<div class=\"highlight-python\"><pre>passwd=$(whoami)\n$MT/bin/paster create --no-interactive -t minitage.instances.openldap myproject db_orga=my-domain db_suffix=com db_port=1389 ssl_port=1636\ncd $INS/sys/etc/openldap</pre>\n</div>\n<p>Include the right schemas in the slapd configuration file:</p>\n<div class=\"highlight-python\"><pre>- core\n- cosine\n- inetorgperson\n- nis:</pre>\n</div>\n<p>Comment out the additional schemas.</p>\n<div class=\"highlight-python\"><pre>$EDITOR $INS/etc/openldap/myproject_my-domain.com-slapd.conf</pre>\n</div>\n<p>Create the base ldif</p>\n<div class=\"highlight-python\"><pre>cat &lt;&lt; EOF|sed \"s/    //g\" &gt; /tmp/initial.ldif\ndn: dc=my-domain,dc=com\nobjectClass: dcObject\nobjectClass: organization\no: Example Company\ndc: my-domain\nstructuralObjectClass: organization\nentryUUID: bde2ec54-fc08-102d-9c3e-0d9dd31353b4\ncreatorsName: cn=Manager,dc=my-domain,dc=com\ncreateTimestamp: 20090703103350Z\nentryCSN: 20090703103350.268281Z#000000#000#000000\nmodifiersName: cn=Manager,dc=my-domain,dc=com\nmodifyTimestamp: 20090703103350Z\n\ndn: cn=Manager,dc=my-domain,dc=com\nobjectClass: organizationalRole\ncn: Manager\nstructuralObjectClass: organizationalRole\nentryUUID: be07d7bc-fc08-102d-9c3f-0d9dd31353b4\ncreatorsName: cn=Manager,dc=my-domain,dc=com\ncreateTimestamp: 20090703103350Z\nentryCSN: 20090703103350.510240Z#000000#000#000000\nmodifiersName: cn=Manager,dc=my-domain,dc=com\nmodifyTimestamp: 20090703103350Z\n\ndn: cn=Professionnels,dc=my-domain,dc=com\nobjectClass: top\nobjectClass: groupOfUniqueNames\nuniqueMember: cn=Manager,dc=my-domain,dc=com\nuniqueMember: cn=hpotter,dc=my-domain,dc=com\ncn: Professionnels\nstructuralObjectClass: groupOfUniqueNames\nentryUUID: f5e1d890-fc08-102d-9c40-0d9dd31353b4\ncreatorsName: cn=Manager,dc=my-domain,dc=com\ncreateTimestamp: 20090703103524Z\nentryCSN: 20090703142607.008076Z#000000#000#000000\nmodifiersName: cn=Manager,dc=my-domain,dc=com\nmodifyTimestamp: 20090703142607Z\n\ndn: ou=People,dc=my-domain,dc=com\nou: People\nobjectClass: top\nobjectClass: organizationalUnit\nobjectClass: domainRelatedObject\nassociatedDomain: my-domain.com\n\nEOF</pre>\n</div>\n<p>Load the base ldif</p>\n<div class=\"highlight-python\"><pre>source $INS/sys/share/minitage/mintiage.env\n$INS/sys//etc/init.d/openldap_myproject_my-domain.com stop\nmy-domain.com.slapadd  -l /tmp/initial.ldif\n$INS/sys//etc/init.d/openldap_myproject_my-domain.com start</pre>\n</div>\n<p>Check</p>\n<div class=\"highlight-python\"><pre>my-domain.com.ldapsearch -w$(whoami)</pre>\n</div>\n<p>How to change the password</p>\n<div class=\"highlight-python\"><pre>passwd=$(my-domain.com.slappasswd  -h'{MD5}');sed -re \"s/\\{MD.*/$passwd/g\" -i $INS/sys/etc/openldap/myproject_my-domain.com-slapd.conf\n$INS/sys//etc/init.d/openldap_myproject_my-domain.com restart</pre>\n</div>\n<p>Check</p>\n<div class=\"highlight-python\"><pre>my-domain.com.ldapsearch -w$passwd</pre>\n</div>\n<p>At this stage, your OpenLDAP server must be configured and listening for input connections.</p>\n</div>\n<div class=\"section\" id=\"cas-server-configuration\">\n<h2>CAS Server configuration<a class=\"headerlink\" href=\"#cas-server-configuration\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>First, you must have a JDK configured and integrated (JAVA_HOME) under the hood\nFor thus to be done, on Debian/Ubuntu, you can issue the followiung commands</p>\n<div class=\"highlight-python\"><pre>cd $MT\nsource bin/activate\nsudo apt-get install openjdk-6-jdk\nexport JAVA_HOME=/usr/lib/jvm/java-6-openjdk/</pre>\n</div>\n<p>Assure to have java in your path and JAVA_HOME defined unless tomcat will not install</p>\n<p>Install tomcat</p>\n<div class=\"highlight-python\"><pre># add tomcat-6.0.20 to minilays/yourminilay/myproject\nvim $MT/minilays/yourminilay/myproject\nminimerge -v myproject</pre>\n</div>\n<p>Install a CAS server instance</p>\n<div class=\"highlight-python\"><pre>$MT/bin/paster create -t minitage.instances.cas --no-interactive myproject http_port=8000</pre>\n</div>\n<p>Notes:</p>\n<blockquote>\n<ul class=\"simple\">\n<li>Default admin credentials:  $(whoami)/secret</li>\n<li>Please have a look on the generated README in $INS</li>\n</ul>\n</blockquote>\n<p>Configure the LDAP server as an authentication backend for the CAS server (<a class=\"reference external\" href=\"http://www.ja-sig.org/wiki/display/CASUM/LDAP\">http://www.ja-sig.org/wiki/display/CASUM/LDAP</a>):</p>\n<blockquote>\n<ul>\n<li><p class=\"first\">comment the bean <em>org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler</em> around the li.91 in $INS/sys/var/data/tomcat/cas/webapps/cas/WEB-INF/deployerConfigContext.xml:</p>\n<div class=\"highlight-python\"><pre>&lt;!--    &lt;bean class=\"org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler\" /&gt;--&gt;</pre>\n</div>\n</li>\n<li><p class=\"first\">add the following Lines under the commented line and adapt the urls:</p>\n<div class=\"highlight-python\"><pre>&lt;bean\n    class=\"org.jasig.cas.adaptors.ldap.FastBindLdapAuthenticationHandler\"&gt;\n    &lt;property name=\"filter\" value=\"uid=%u,ou=People,dc=my-domain,dc=com\" /&gt;\n    &lt;property name=\"contextSource\" ref=\"contextSource\" /&gt;\n&lt;/bean&gt;</pre>\n</div>\n</li>\n<li><p class=\"first\">under the bean containing the previous one, just add:</p>\n<div class=\"highlight-python\"><pre>    &lt;bean id=\"contextSource\" class=\"org.springframework.ldap.core.support.LdapContextSource\"&gt;\n            &lt;property name=\"anonymousReadOnly\" value=\"false\"/&gt;\n            &lt;property name=\"pooled\" value=\"true\"/&gt;\n            &lt;property name=\"urls\"&gt;\n                    &lt;list&gt;\n        &lt;!-- TO ENABLE SSL,  YOU MUST INSTALL THE SERVER CERTIFICATE INE THE JAVA SSL KEYSTORE\n                            &lt;value&gt;ldaps://localhost:1389/&lt;/value&gt;\n        --&gt;\n                            &lt;value&gt;ldap://localhost:1389/&lt;/value&gt;\n                    &lt;/list&gt;\n            &lt;/property&gt;\n            &lt;property name=\"baseEnvironmentProperties\"&gt;\n                    &lt;map&gt;\n        &lt;!--\n                            &lt;entry&gt;\n                                    &lt;key&gt;\n                                            &lt;value&gt;java.naming.security.protocol&lt;/value&gt;\n                                    &lt;/key&gt;\n                                    &lt;value&gt;ssl&lt;/value&gt;\n                            &lt;/entry&gt;\n        --&gt;\n                            &lt;entry&gt;\n                                    &lt;key&gt;\n                                            &lt;value&gt;java.naming.security.authentication&lt;/value&gt;\n                                    &lt;/key&gt;\n                                    &lt;value&gt;simple&lt;/value&gt;\n                            &lt;/entry&gt;\n                    &lt;/map&gt;\n            &lt;/property&gt;\n    &lt;/bean&gt;\n\n- Create some test users ::\n\n            cat &lt;&lt; EOF|sed \"s/                    //g\" &gt; /tmp/test.ldif\n            dn: uid=test1,ou=People,dc=my-domain,dc=com\n            uid: test1\n            cn: test1\n            sn: test1\n            mail: test1@my-domain.com\n            objectClass: person\n            objectClass: organizationalPerson\n            objectClass: inetOrgPerson\n            objectClass: top\n            userPassword: foo\n\n            dn: uid=test,ou=People,dc=my-domain,dc=com\n            uid: test\n            cn: test\n            sn: test\n            mail: test@my-domain.com\n            objectClass: person\n            objectClass: organizationalPerson\n            objectClass: inetOrgPerson\n            objectClass: top\n            userPassword: foo\n            EOF</pre>\n</div>\n</li>\n</ul>\n</blockquote>\n<p>Insert:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"n\">my</span><span class=\"o\">-</span><span class=\"n\">domain</span><span class=\"o\">.</span><span class=\"n\">com</span><span class=\"o\">.</span><span class=\"n\">ldapadd</span> <span class=\"o\">-</span><span class=\"n\">f</span> <span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">test</span><span class=\"o\">.</span><span class=\"n\">ldif</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"checks\">\n<h2>Checks<a class=\"headerlink\" href=\"#checks\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>I can connect; see my own password but not the other one&#8217;s</p>\n<div class=\"highlight-python\"><pre>$ my-domain.com.ldapsearch -D uid=test,ou=People,dc=my-domain,dc=com -x -wfoo uid=test1\n# extended LDIF\n#\n# LDAPv3\n# base &lt;dc=my-domain,dc=com&gt; (default) with scope subtree\n# filter: uid=test1\n# requesting: ALL\n#\n\n# test1, People, my-domain.com\ndn: uid=test1,ou=People,dc=my-domain,dc=com\nuid: test1\ncn: test1\nsn: test1\nmail: test1@my-domain.com\nobjectClass: person\nobjectClass: organizationalPerson\nobjectClass: inetOrgPerson\nobjectClass: top\n\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 2\n# numEntries: 1\n$ my-domain.com.ldapsearch -D uid=test,ou=People,dc=my-domain,dc=com -x -wfoo uid=test\n# extended LDIF\n#\n# LDAPv3\n# base &lt;dc=my-domain,dc=com&gt; (default) with scope subtree\n# filter: uid=test\n# requesting: ALL\n#\n\n# test, People, my-domain.com\ndn: uid=test,ou=People,dc=my-domain,dc=com\nuid: test\ncn: test\nsn: test\nmail: test@my-domain.com\nobjectClass: person\nobjectClass: organizationalPerson\nobjectClass: inetOrgPerson\nobjectClass: top\nuserPassword:: Zm9v\n\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 2\n# numEntries: 1</pre>\n</div>\n<p>I can authenticate on the CAS server (TTW) with the test1/foo login</p>\n<div class=\"highlight-python\"><pre>Connexion r\u00e9ussie\n\nVous vous \u00eates authentifi\u00e9(e) aupr\u00e8s du Service Central d'Authentification.\n\nPour des raisons de s\u00e9curit\u00e9, veuillez vous d\u00e9connecter et fermer votre navigateur lorsque vous avez fini d'acc\u00e9der aux services authentifi\u00e9s.</pre>\n</div>\n</div>\n</div>\n", "display_toc": true, "title": "Install a project with a CAS server wired on an OpenLDAP backend", "sourcename": "usecases/deploying_a_cas_server.txt", "customsidebar": null, "current_page_name": "usecases/deploying_a_cas_server", "next": {"link": "../FAQ/", "title": "FAQ"}, "rellinks": [["genindex", "General Index", "I", "index"], ["usecases/FAQ", "FAQ", "N", "next"], ["usecases/plone3", "A plone3 project with relstorage (postgresql) and varnish2 support", "P", "previous"]], "meta": {}, "parents": [{"link": "../", "title": "Minitage in the daily use of a developer"}], "sidebars": ["searchbox.html", "globaltoc.html"], "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Install a project with a CAS server wired on an OpenLDAP backend</a><ul>\n<li><a class=\"reference internal\" href=\"#minitage\">Minitage</a></li>\n<li><a class=\"reference internal\" href=\"#ldap-configuration\">Ldap configuration</a></li>\n<li><a class=\"reference internal\" href=\"#cas-server-configuration\">CAS Server configuration</a></li>\n<li><a class=\"reference internal\" href=\"#checks\">Checks</a></li>\n</ul>\n</li>\n</ul>\n", "prev": {"link": "../plone3/", "title": "A plone3 project with relstorage (postgresql) and varnish2 support"}, "metatags": ""}